const gulp = require('gulp')
const plugins = require('gulp-load-plugins')
const config = require('./config')({ dist: 'aaa' })

const $ = plugins()

gulp.task('stylesheets', () => gulp.src(`${config.src}/*.{scss,sass}`)
  .pipe($.plumber(config.plumberHandler))
  .pipe($.sass(config.sassSettings))
  .pipe($.combineMq())
  .pipe($.autoprefixer(config.autoprefixer))
  .pipe($.size({ title: 'Stylesheets!', showFiles: true }))
  .pipe(gulp.dest(`${config.dist}`))
  .pipe($.cssnano({ autoprefixer: config.autoprefixer, add: true }))
  .pipe($.rename({ suffix: '.min' }))
  .pipe($.size({ title: 'Stylesheets!', showFiles: true }))
  .pipe(gulp.dest(`${config.dist}`))
  .pipe($.plumber.stop()))
